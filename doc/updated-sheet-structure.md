# 📋 更新されたGoogleスプレッドシート構造

カードマスターシートに「型番」列と「参考販売価格」列を追加しました。

## 🔄 変更内容

### 変更前（旧構造）
| A列 | B列 | C列 | D列 | E列 |
|-----|-----|-----|-----|-----|
| カード名 | 弾ID | レアリティ | 買取価格 | 市場価格 |

### 変更後（新構造）
| A列 | B列 | C列 | D列 | E列 | F列 |
|-----|-----|-----|-----|-----|-----|
| カード名 | 型番 | 弾ID | レアリティ | 買取価格 | 参考販売価格 |

## 📊 具体的な設定方法

### カードマスターシート
1. **既存のスプレッドシートを開く**
2. **「カードマスター」シートを選択**
3. **B列に「型番」列を挿入**
   - B列を右クリック → 「左に1列を挿入」
4. **ヘッダーを更新**
   ```
   A1: カード名
   B1: 型番          ← 新規追加
   C1: 弾ID
   D1: レアリティ
   E1: 買取価格
   F1: 参考販売価格  ← 「市場価格」から変更
   ```

5. **サンプルデータの例**
   ```
   A2: ボルメテウス・ホワイト・ドラゴン
   B2: DM01-001      ← 型番を追加
   C2: DM01
   D2: MR
   E2: 8000
   F2: 12000         ← 参考販売価格
   ```

## 🔢 型番の付け方

### 推奨フォーマット
```
[弾ID]-[通し番号]
例: DM01-001, DM01-002, DM24RP1-001
```

### 型番の例
- **第1弾**: DM01-001, DM01-002, DM01-003...
- **第24弾**: DM24-001, DM24-002, DM24-003...
- **24RP1弾**: DM24RP1-001, DM24RP1-002...

## 💰 参考販売価格とは

- **買取価格**: お店がカードを買い取る価格
- **参考販売価格**: お店がカードを販売する価格（市場相場）

期待値計算では買取価格を使用しますが、参考販売価格も表示して相場感を提供します。

## 🔄 データベース更新

既存のデータベースを新しい構造に対応させるため、以下のマイグレーションを実行してください：

```bash
# データベース構造を更新
npm run migrate
```

または、Supabaseダッシュボードで以下のSQLを実行：

```sql
-- 型番カラムを追加
ALTER TABLE public.cards 
ADD COLUMN IF NOT EXISTS card_number TEXT;

-- 参考販売価格カラムを追加
ALTER TABLE public.cards 
ADD COLUMN IF NOT EXISTS reference_price INTEGER;

-- 既存のmarket_priceをreference_priceにコピー
UPDATE public.cards 
SET reference_price = market_price 
WHERE market_price IS NOT NULL;

-- market_priceカラムを削除
ALTER TABLE public.cards 
DROP COLUMN IF EXISTS market_price;
```

## ✅ 更新後の確認手順

1. **スプレッドシートの構造確認**
   - カードマスターシートが6列になっている
   - ヘッダーが正しく設定されている
   - サンプルデータが入力されている

2. **データ同期テスト**
   ```bash
   npm run sync-sheets
   ```

3. **同期結果の確認**
   - エラーが出ないこと
   - カードデータに型番が含まれていること
   - 参考販売価格が正しく同期されていること

## 🐛 トラブルシューティング

### ❌ 「名前、型番、弾ID、レアリティが必須」エラー
- **原因**: B列（型番）が空の行がある
- **解決**: 全てのカードに型番を設定する

### ❌ 同期時に一部のカードが無視される
- **原因**: 必須項目（A,B,C,D列）のいずれかが空
- **解決**: 全ての必須列にデータを入力する

### ❌ 参考販売価格が同期されない
- **原因**: F列が数値以外の形式
- **解決**: F列を数値形式に変更する

## 📝 今後の運用

### 新しいカードを追加する場合
1. カード名を入力（A列）
2. 型番を入力（B列） - 例: DM01-055
3. 弾IDを入力（C列） - 例: DM01
4. レアリティを入力（D列） - 例: SR
5. 買取価格を入力（E列） - 例: 2000
6. 参考販売価格を入力（F列） - 例: 3500

### 価格更新の場合
- E列（買取価格）とF列（参考販売価格）を更新
- メタデータシートの最終更新日時を更新
- `npm run sync-sheets` を実行

これで型番と参考販売価格に対応した新しい構造になりました！